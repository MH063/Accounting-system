<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ç™»å½•åŠŸèƒ½ - ä¿®å¤ç‰ˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-section h3 { margin-top: 0; color: #333; }
        .success { color: #52c41a; font-weight: bold; }
        .error { color: #ff4d4f; font-weight: bold; }
        .info { color: #1890ff; }
        button { background: #1890ff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #40a9ff; }
        input { width: 200px; padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
        .result { background: #f9f9f9; padding: 10px; margin: 10px 0; border-radius: 3px; white-space: pre-wrap; }
        .status { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .status.success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .status.error { background: #fff2f0; border: 1px solid #ffccc7; }
        .status.info { background: #e6f7ff; border: 1px solid #91d5ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æµ‹è¯•ç™»å½•åŠŸèƒ½ - ä¿®å¤éªŒè¯</h1>
        <p class="info">æµ‹è¯•å‰ç«¯ä¿®å¤åçš„ç™»å½•åŠŸèƒ½ï¼Œé‡ç‚¹éªŒè¯ç”¨æˆ·å"ç®¡ç†å‘˜"æ˜¯å¦èƒ½æ­£å¸¸ç™»å½•</p>
        
        <!-- ç™»å½•çŠ¶æ€ -->
        <div class="test-section">
            <h3>1. å½“å‰æœåŠ¡çŠ¶æ€</h3>
            <div id="service-status"></div>
        </div>
        
        <!-- ç”¨æˆ·åç™»å½•æµ‹è¯• -->
        <div class="test-section">
            <h3>2. ç”¨æˆ·å"ç®¡ç†å‘˜"ç™»å½•æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¿®å¤åçš„ç”¨æˆ·åç™»å½•åŠŸèƒ½</p>
            <div>
                <input type="text" id="username" value="ç®¡ç†å‘˜" readonly>
                <input type="password" id="password" value="Admin123." readonly>
                <button onclick="testUsernameLogin()">æµ‹è¯•ç”¨æˆ·åç™»å½•</button>
            </div>
            <div id="username-result"></div>
        </div>
        
        <!-- é‚®ç®±ç™»å½•æµ‹è¯• -->
        <div class="test-section">
            <h3>3. é‚®ç®±ç™»å½•æµ‹è¯•</h3>
            <p>éªŒè¯é‚®ç®±ç™»å½•æ˜¯å¦ä¾ç„¶æ­£å¸¸å·¥ä½œ</p>
            <div>
                <input type="text" id="email" value="admin@example.com" readonly>
                <input type="password" id="email-password" value="Admin123." readonly>
                <button onclick="testEmailLogin()">æµ‹è¯•é‚®ç®±ç™»å½•</button>
            </div>
            <div id="email-result"></div>
        </div>
        
        <!-- å‰ç«¯é¡µé¢è·³è½¬ -->
        <div class="test-section">
            <h3>4. è®¿é—®å‰ç«¯ç™»å½•é¡µé¢</h3>
            <p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å‰ç«¯ç™»å½•é¡µé¢è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•</p>
            <button onclick="openFrontend()">æ‰“å¼€å‰ç«¯ç™»å½•é¡µé¢</button>
            <p class="info">å‰ç«¯åœ°å€: <a href="http://10.26.120.9:8001/login" target="_blank">http://10.26.120.9:8001/login</a></p>
        </div>
        
        <!-- è¯¦ç»†æ—¥å¿— -->
        <div class="test-section">
            <h3>5. è¯¦ç»†æµ‹è¯•æ—¥å¿—</h3>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            <div id="logs" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://10.26.120.9:4000';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            const logsDiv = document.getElementById('logs');
            logsDiv.textContent += logEntry + '\n';
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(logEntry);
        }
        
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.innerHTML = message;
        }
        
        function clearLogs() {
            document.getElementById('logs').textContent = '';
        }
        
        function checkServiceStatus() {
            log('æ£€æŸ¥æœåŠ¡çŠ¶æ€...');
            const statusDiv = document.getElementById('service-status');
            
            Promise.all([
                fetch(`${API_BASE}/api/auth/test`).then(r => r.ok ? 'âœ…' : 'âŒ'),
                fetch('http://10.26.120.9:8001').then(r => r.ok ? 'âœ…' : 'âŒ')
            ]).then(([backendStatus, frontendStatus]) => {
                statusDiv.innerHTML = `
                    <div>åç«¯æœåŠ¡ (${API_BASE}): ${backendStatus}</div>
                    <div>å‰ç«¯æœåŠ¡ (http://10.26.120.9:8001): ${frontendStatus}</div>
                `;
                log(`æœåŠ¡çŠ¶æ€æ£€æŸ¥å®Œæˆ - åç«¯: ${backendStatus}, å‰ç«¯: ${frontendStatus}`);
            }).catch(error => {
                statusDiv.innerHTML = `<span class="error">âŒ æœåŠ¡çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}</span>`;
                log(`æœåŠ¡çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            });
        }
        
        async function testUsernameLogin() {
            log('å¼€å§‹æµ‹è¯•ç”¨æˆ·å"ç®¡ç†å‘˜"ç™»å½•...');
            showStatus('username-result', 'æ­£åœ¨æµ‹è¯•...', 'info');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'TestClient/1.0'
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password,
                        captchaCode: '1234',
                        sessionId: 'test-session-123'
                    })
                });
                
                const result = await response.json();
                log(`ç”¨æˆ·åç™»å½•å“åº”: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    showStatus('username-result', 
                        `<div class="success">âœ… ç”¨æˆ·åç™»å½•æˆåŠŸ!</div>
                         <div>ç”¨æˆ·: ${result.data.user.username}</div>
                         <div>é‚®ç®±: ${result.data.user.email}</div>
                         <div>Tokené•¿åº¦: ${result.data.tokens.accessToken.length}</div>`, 
                        'success');
                    log('âœ… ç”¨æˆ·å"ç®¡ç†å‘˜"ç™»å½•æµ‹è¯•é€šè¿‡ï¼', 'success');
                } else {
                    showStatus('username-result', 
                        `<div class="error">âŒ ç”¨æˆ·åç™»å½•å¤±è´¥</div>
                         <div>é”™è¯¯: ${result.message || 'æœªçŸ¥é”™è¯¯'}</div>`, 
                        'error');
                    log(`âŒ ç”¨æˆ·åç™»å½•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                showStatus('username-result', 
                    `<div class="error">âŒ è¯·æ±‚å¤±è´¥</div>
                     <div>é”™è¯¯: ${error.message}</div>`, 
                    'error');
                log(`âŒ ç”¨æˆ·åç™»å½•è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testEmailLogin() {
            log('å¼€å§‹æµ‹è¯•é‚®ç®±ç™»å½•...');
            showStatus('email-result', 'æ­£åœ¨æµ‹è¯•...', 'info');
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('email-password').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'TestClient/1.0'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        captchaCode: '1234',
                        sessionId: 'test-session-123'
                    })
                });
                
                const result = await response.json();
                log(`é‚®ç®±ç™»å½•å“åº”: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    showStatus('email-result', 
                        `<div class="success">âœ… é‚®ç®±ç™»å½•æˆåŠŸ!</div>
                         <div>ç”¨æˆ·: ${result.data.user.username}</div>
                         <div>é‚®ç®±: ${result.data.user.email}</div>
                         <div>Tokené•¿åº¦: ${result.data.tokens.accessToken.length}</div>`, 
                        'success');
                    log('âœ… é‚®ç®±ç™»å½•æµ‹è¯•é€šè¿‡ï¼', 'success');
                } else {
                    showStatus('email-result', 
                        `<div class="error">âŒ é‚®ç®±ç™»å½•å¤±è´¥</div>
                         <div>é”™è¯¯: ${result.message || 'æœªçŸ¥é”™è¯¯'}</div>`, 
                        'error');
                    log(`âŒ é‚®ç®±ç™»å½•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                showStatus('email-result', 
                    `<div class="error">âŒ è¯·æ±‚å¤±è´¥</div>
                     <div>é”™è¯¯: ${error.message}</div>`, 
                    'error');
                log(`âŒ é‚®ç®±ç™»å½•è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function openFrontend() {
            window.open('http://10.26.120.9:8001/login', '_blank');
            log('å·²åœ¨æ–°çª—å£æ‰“å¼€å‰ç«¯ç™»å½•é¡µé¢');
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€
        window.onload = function() {
            log('ğŸš€ ç™»å½•åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            checkServiceStatus();
        };
    </script>
</body>
</html>