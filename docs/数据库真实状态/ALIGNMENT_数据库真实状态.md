# ALIGNMENT_数据库真实状态

## 项目上下文分析
- **项目名称**: 会计系统 (Accounting-system)
- **技术栈**: 
  - 前端: Vue 3 + Vite + TypeScript (AI-admin)
  - 后端: Node.js + Express (AI-server)
  - 数据库: PostgreSQL
- **现状**: 首页展示的数据库状态指标中，部分数据（如缓存命中率、慢查询等）存在模拟或硬编码逻辑，不符合用户对真实性的要求。

## 需求理解确认
### 原始需求
数据库状态详情的以下指标必须是真实的：
1. **当前连接数**: 数据库当前的活跃连接。
2. **最大连接数**: 数据库配置允许的最大连接。
3. **缓存命中率**: 数据库缓冲池的实际命中百分比。
4. **慢查询数**: 执行时间超过阈值的查询数量。
5. **表空间使用**: 数据库文件在磁盘上占用的真实空间。

### 需求边界
- **后端**: 修改 `systemStatusService.js`，通过 SQL 查询 PostgreSQL 系统视图获取真实指标。
- **前端**: 确保 `Home.vue` 正确接收并渲染这些真实指标。
- **数据库**: 不修改表结构，仅通过 `pg_catalog` 和 `pg_stat` 等系统视图查询。

### 疑问澄清
1. **慢查询阈值**: 默认为 1000ms (1秒)，可通过配置文件调整。
2. **权限问题**: 查询系统视图可能需要较高的数据库权限，需确保连接池账号有权访问 `pg_stat_activity` 和 `pg_database_size`。
3. **慢查询插件**: PostgreSQL 默认可能未开启 `pg_stat_statements` 扩展。如果未开启，将回退到查询 `pg_stat_activity` 中运行时间较长的活跃查询，并在建议中提示用户开启扩展。

## 智能决策
- **技术选型**: 直接使用 PostgreSQL 原生系统查询函数。
- **降级策略**: 如果某些系统视图不可用（如权限受限），返回具体错误信息而非模拟数据。

## 验收标准
- [ ] 数据库状态面板显示的数值随数据库实际负载实时变化。
- [ ] 当前连接数与 `SELECT count(*) FROM pg_stat_activity` 一致。
- [ ] 最大连接数与 `SHOW max_connections` 一致。
- [ ] 表空间使用显示真实的 MB/GB 数值。
