# 记账系统改进版需求文档

## 📋 文档变更说明
本文档基于原始需求文档进行结构优化和内容整理，专注于业务需求和功能描述，技术实现细节已移至《技术实现文档》中。

## 📖 目录

### 1. 项目概述
1.1 系统简介
1.2 项目目标
1.3 核心价值
1.4 项目时间规划与里程碑

### 2. 用户角色与权限
2.1 系统初始化与角色定位
2.2 角色定义
2.3 权限矩阵
2.4 页面访问权限

### 3. 核心功能模块
3.1 用户注册与登录
3.2 寝室管理
3.3 成员管理
3.4 费用记录管理
3.5 智能分摊功能
3.6 账单管理
3.7 统计分析
3.8 个人信息管理

### 4. 支付功能模块
4.1 收款码管理
4.2 扫码支付
4.3 邀请码管理
4.4 支付流程优化

### 5. 系统管理功能
5.1 用户管理
5.2 费用类型管理
5.3 客户端功能管理
5.4 系统设置
5.5 通知提醒
5.6 管理员专用功能模块

### 6. 风险管理与应对策略
6.1 项目风险识别
6.2 风险评估与应对
6.3 应急预案

### 7. 验收标准
7.1 功能验收标准
7.2 性能验收标准
7.3 用户体验验收标准

---

## 1. 项目概述

### 1.1 系统简介
记账系统是一款专为学生寝室费用管理设计的智能化应用，旨在简化费用分摊和收缴流程，提高寝室财务管理的透明度和效率。

### 1.2 项目目标
- **主要目标**：实现寝室费用的智能化分摊和收缴管理
- **核心价值**：减少费用纠纷，提高支付效率，增强财务透明度
- **技术目标**：采用现代化技术栈，提供良好的用户体验

### 1.3 核心价值
- **智能化分摊**：根据成员在寝天数和使用情况自动计算分摊比例
- **数字化收缴**：支持扫码支付，简化收缴流程
- **透明化管理**：实时记录和展示费用明细，确保财务透明
- **高效协作**：支持多人协作管理，提高寝室财务管理效率

### 1.4 项目时间规划与里程碑

#### 第一阶段：基础功能开发（4周）
- **里程碑1**：完成用户注册登录、角色权限系统（第1周）
- **里程碑2**：完成寝室管理、成员管理功能（第2周）
- **里程碑3**：完成费用记录管理、智能分摊功能（第3-4周）

#### 第二阶段：支付与账单功能（3周）
- **里程碑4**：完成收款码管理、扫码支付功能（第5周）
- **里程碑5**：完成邀请码管理、支付流程优化（第6周）
- **里程碑6**：完成账单管理、统计分析功能（第7周）

#### 第三阶段：系统管理功能（3周）
- **里程碑7**：完成用户管理、费用类型管理（第8周）
- **里程碑8**：完成客户端功能管理、系统设置（第9周）
- **里程碑9**：完成通知提醒、管理员专用功能（第10周）

#### 第四阶段：测试与优化（2周）
- **里程碑10**：完成系统测试、性能优化（第11周）
- **里程碑11**：完成用户验收测试、文档完善（第12周）

---

## 2. 用户角色与权限

### 2.1 系统角色定义

| 角色 | 主要职责 | 权限范围 | 登录平台 | 角色配置约束 |
|------|----------|----------|----------|------------|
| 系统管理员 | 系统最高管理员，拥有最高权限，负责系统安全、架构管理、权限监督和系统维护，监督所有管理员操作，不直接参与业务数据管理但可监督和审核管理员的所有业务操作 | 系统架构配置、数据库管理、安全策略、系统部署、紧急故障处理、系统监控、管理员行为监督、管理员权限管理、系统安全审计、系统合规检查、权限制衡机制 | 仅管理端 | 全局唯一 |
| 管理员 | 业务运营管理员，负责用户管理、数据监控、内容管理、纠纷处理等业务层面的管理 | 用户管理、数据监控、内容管理、纠纷处理、日常运营支持、业务数据管理 | 管理端 + 客户端 | 全局唯一 |
| 寝室长 | 寝室费用总负责人，管理寝室日常费用和成员协调 | 寝室创建、成员邀请、费用创建、费用审核、寝室配置管理 | 仅客户端 | 同寝室唯一 |
| 缴费人 | 负责费用收缴和支付的成员，确保费用收缴到位 | 收款码管理、支付确认、费用审核、账单管理 | 仅客户端 | 同寝室可多个 |
| 普通用户 | 普通寝室成员，参与费用分摊和支付 | 查看账单、支付费用、费用确认、个人设置 | 仅客户端 | 同寝室可多个 |

### 2.2 权限矩阵

#### 2.2.1 角色配置约束（重要业务规则）
- **寝室长配置规则**：同一寝室内只能有1个寝室长，负责寝室的全面管理和协调
- **缴费人配置规则**：同一寝室内可以有多个缴费人，分别负责不同类型费用的收缴
- **角色唯一性**：除缴费人外，其他角色在同一寝室内均有唯一性限制
- **角色变更限制**：寝室长变更需要管理员审核，其他角色变更由寝室长管理

#### 2.2.2 登录平台权限
- **管理端登录**：仅系统管理员和管理员可登录管理端平台
- **客户端登录**：管理员、寝室长、缴费人、普通用户可登录客户端
- **平台权限隔离**：管理端和客户端功能完全隔离，互不通用

#### 2.2.3 操作权限
- **查看权限**：所有用户可查看与自身相关的费用信息
- **创建权限**：寝室长和指定缴费人可创建费用记录
- **编辑权限**：创建者可编辑未审核的费用记录
- **删除权限**：寝室长可删除费用记录
- **审核权限**：缴费人可审核相关费用

#### 2.2.4 特殊权限
- **收款码管理**：只有缴费人可上传和管理收款码
- **支付确认**：只有收款码所属用户可确认收到付款（任何其他角色包括管理员都无权强制确认支付状态）
- **邀请码生成**：只有寝室长可生成邀请码

#### 2.2.5 系统管理员最高监督权限（制衡管理员权限）
- **管理员行为监督权限**
  - 实时监控管理员的所有操作行为
  - 查看管理员登录日志、操作记录和行为轨迹
  - 监控管理员对用户权限的修改操作
  - 审核管理员的费用调整和纠纷处理决策

- **管理员权限管理权限**
  - 创建、修改、禁用管理员账户
  - 设置管理员的操作权限范围和限制条件
  - 重置管理员密码和权限设置
  - 审批管理员的权限升级请求

- **管理员操作审批权限**
  - 审批管理员的重要系统配置变更
  - 审核管理员删除或修改关键数据的行为
  - 批准管理员的系统维护和升级操作
  - 监控管理员的客户端功能控制操作

- **系统安全监督权限**
  - 监控系统安全事件和异常操作
  - 审核管理员的安全策略配置变更
  - 检查管理员的用户数据访问记录
  - 执行系统级安全审计和合规检查

- **管理员绩效监督权限**
  - 评估管理员的工作绩效和操作质量
  - 查看管理员处理的用户投诉和纠纷
  - 监控管理员的响应时间和解决效率
  - 生成管理员行为分析报告

#### 2.2.6 管理员特殊权限（业务运营管理）
- **全局用户管理**
  - 查看所有用户信息和统计数据
  - 创建、编辑、禁用任何用户账户
  - 重置用户密码和权限
  - 查看用户登录日志和行为记录

- **系统配置管理**
  - 修改系统全局配置参数
  - 设置费用类型和标准
  - 配置支付方式和限制
  - 设置系统通知和提醒规则

- **数据监控与审计**
  - 查看所有寝室和费用数据
  - 监控系统运行状态和性能指标
  - 查看操作日志和审计记录
  - 生成系统级统计报告

- **纠纷处理权限**
  - 介入寝室费用争议处理
  - 查看所有支付争议详情
  - 执行系统级费用调整
  - 冻结/解冻寝室或用户账户

- **系统维护权限**
  - 执行数据库备份和恢复
  - 管理系统公告和通知
  - 升级系统配置和参数
  - 监控安全事件和异常操作

- **客户端功能控制权限**
  - 动态开启/关闭客户端功能模块
  - 配置客户端功能的使用权限和限制
  - 添加新功能到客户端并设置访问条件
  - 禁用或移除客户端现有功能
  - 设置功能灰度发布和A/B测试
  - 控制功能对不同角色用户的可见性和可用性

#### 2.2.7 权限制衡机制（系统安全核心）
- **双重确认机制**
  - 管理员执行敏感操作需要系统管理员审批
  - 重要配置变更需要系统管理员确认
  - 用户权限修改需要系统管理员审核
  - 系统级操作需要系统管理员授权

- **权限递减原则**
  - 系统管理员拥有最高权限，可监督所有角色
  - 管理员权限受系统管理员监督和限制
  - 业务操作权限按层级递减分配
  - 特殊权限需要上级角色授权

- **操作审计机制**
  - 所有管理员操作自动记录审计日志
  - 重要操作实时通知系统管理员
  - 异常操作触发安全告警
  - 操作数据定期备份和归档

- **安全监督流程**
  - 系统管理员定期审查管理员操作记录
  - 每月生成管理员行为分析报告
  - 发现异常立即启动调查流程
  - 支持紧急权限冻结和操作回滚

---

## 3. 核心功能模块

### 3.1 用户注册与登录
- **用户注册**：通过邀请码注册或管理员邀请注册
- **身份验证**：支持邮箱、手机号等多种验证方式
- **权限分配**：根据用户角色自动分配相应权限（管理员可手动调整权限分配）

### 3.2 寝室管理
- **寝室创建**：寝室长创建寝室并设置基本信息（管理员可创建/管理全局寝室）
- **成员邀请**：通过邀请码邀请新成员加入（管理员可跨寝室邀请用户）
- **成员管理**：添加、移除成员，设置成员角色（管理员可跨寝室管理所有成员）

### 3.3 成员管理
- **成员信息**：管理成员基本信息、联系方式（管理员可查看所有寝室成员信息）
- **成员状态**：管理成员入住、退宿状态（管理员可强制调整成员状态）
- **权限管理**：设置成员的权限级别（管理员可重置或修改任何用户权限）

### 3.4 费用记录管理
- **费用创建**：创建费用记录，设置费用类型和金额（管理员可跨寝室管理所有费用记录）
- **费用审核**：缴费人对费用进行审核确认（管理员可强制通过或拒绝任何费用审核）
- **费用编辑**：支持对未审核费用进行修改（管理员可修改任何费用记录）

### 3.5 智能分摊功能
- **基础分摊**：按人数平均分摊费用（管理员可调整全局分摊规则）
- **智能算法**：考虑在寝天数、使用频率等因素（管理员可配置分摊算法参数）
- **自定义分摊**：支持手动调整分摊比例（管理员可强制调整任何分摊方案）

### 3.6 账单管理
- **账单生成**：定期生成费用账单（管理员可生成全系统账单报表）
- **支付状态**：跟踪支付状态和进度（管理员可查看所有支付状态）
- **账单查询**：支持历史账单查询和导出（管理员可查询和导出全系统账单数据）

### 3.7 统计分析
- **支出统计**：统计各类费用支出情况
- **趋势分析**：分析费用支出趋势
- **预算管理**：设置和跟踪预算使用情况

### 3.8 个人信息管理
- **基本信息**：管理用户个人信息
- **偏好设置**：个性化偏好配置
- **安全设置**：密码修改、安全验证等

---

## 4. 支付功能模块

### 4.1 收款码管理
- **收款码上传**：支持微信、支付宝收款码上传（管理员可管理全局收款码配置）
- **码状态管理**：支持收款码的激活/停用（管理员可强制停用任何收款码）
- **安全性验证**：验证收款码的有效性和安全性（管理员可执行收款码安全检查）

### 4.2 扫码支付
- **账单确认**：用户确认应支付金额（管理员仅可查看支付账单，不可调整金额）
- **收款码展示**：展示收款人的收款码（管理员可查看所有收款码）
- **支付确认**：仅收款人可以确认收到款项，其他任何角色（包括管理员）都无权强制确认或调整支付状态
- **状态流转**：待支付 → 审核中 → 待收款确认 → 已完成。最终转账成功状态只有收款人可以决定

### 4.3 邀请码管理
- **邀请码生成**：自动生成4位数字邀请码（管理员可生成全局邀请码）
- **邀请码验证**：验证邀请码的有效性和使用状态（管理员可验证任何邀请码）
- **使用限制**：支持使用次数和过期时间设置（管理员可修改任何邀请码限制）

### 4.4 支付流程优化
- **离线支付**：支持离线查看账单和收款码（管理员可配置离线支付策略）
- **支付提醒**：自动发送支付提醒通知（管理员可发送全系统通知）
- **支付记录**：完整的支付历史记录（管理员可查看全系统支付记录）

---

## 5. 系统管理功能

### 5.1 用户管理（管理员功能）
- **用户信息管理**：查看、编辑用户基本信息
- **权限管理**：分配和调整用户权限
- **用户状态管理**：启用、禁用用户账户
- **批量操作**：支持批量用户管理操作
- **用户导入导出**：支持用户数据的批量导入和导出

### 5.2 费用类型管理
- **类型创建**：创建自定义费用类型（管理员可创建全局费用类型）
- **类型编辑**：修改费用类型名称和描述（管理员可修改全局费用类型）
- **类型排序**：设置费用类型显示顺序（管理员可设置全局费用类型顺序）

### 5.3 客户端功能管理（管理员核心功能）

#### 5.3.1 功能模块控制
- **动态功能开关**
  - 实时控制客户端各功能模块的启用/禁用状态
  - 支持批量功能开启/关闭操作
  - 功能状态变更即时生效，无需重启应用
  - 提供功能切换历史记录和回滚机制

- **条件式功能访问**
  - 基于用户角色、时间、设备类型等条件控制功能访问
  - 支持地理位置、网络环境等上下文条件
  - 功能可用性动态计算和实时验证
  - 支持功能依赖关系配置（如A功能依赖B功能开启）

#### 5.3.2 新功能发布
- **增量功能添加**
  - 支持热更新方式添加新功能模块
  - 功能代码模块化设计，支持按需加载
  - 新功能上线支持多种发布策略（立即发布、定时发布、分批发布）
  - 功能版本管理和兼容性检查

- **灰度发布控制**
  - 基于用户群体的分批发布（按角色、按用户ID、按注册时间等）
  - 支持设定灰度发布比例和持续时间
  - 实时监控灰度功能使用情况和用户反馈
  - 自动回滚机制：异常检测触发自动回滚

- **A/B测试框架**
  - 支持在同一功能上的多版本并行测试
  - 随机或基于规则的用户分组机制
  - 功能使用效果数据收集和分析
  - 测试结果自动统计和决策支持

#### 5.3.3 功能移除与禁用
- **功能废弃处理**
  - 支持功能的优雅下线（先禁用后移除）
  - 下线前向用户发送通知和迁移提示
  - 提供功能替代方案和用户引导
  - 数据迁移和备份机制

- **维护模式切换**
  - 一键开启功能维护模式
  - 维护期间功能访问限制和用户提示
  - 维护进度可视化和预计完成时间
  - 维护完成后自动恢复正常访问

#### 5.3.4 功能权限管理
- **精细化权限控制**
  - 功能级别的权限细分（查看、使用、管理、配置）
  - 基于RBAC模型的权限继承机制
  - 临时权限授权和自动过期机制
  - 权限变更实时生效，无需用户重新登录

- **使用限制配置**
  - 功能使用次数限制（日/周/月/年）
  - 功能使用时间窗口限制（工作时间、营业时间等）
  - 功能使用地理限制（校园内、宿舍区等）
  - 使用频率限制和节流机制

### 5.4 系统设置（管理员功能）
- **基础配置**：系统基础参数设置
- **支付配置**：支付相关参数配置
- **通知配置**：通知方式和频率设置
- **系统维护**：数据库备份、日志清理、系统监控
- **安全配置**：密码策略、登录限制、安全审计

### 5.5 通知提醒
- **费用通知**：费用创建、审核、支付相关通知
- **系统通知**：系统更新、维护等通知
- **个人通知**：个人相关的重要消息

### 5.6 管理员专用功能模块
#### 5.6.1 数据监控中心
- **实时监控**：系统负载、用户活跃度、费用数据统计
- **性能指标**：响应时间、并发用户数、数据库性能
- **异常告警**：异常操作、错误率、安全威胁监控

#### 5.6.2 用户行为分析
- **登录统计**：用户登录频率、在线时长分析
- **操作审计**：详细记录用户关键操作行为
- **数据报表**：生成系统使用情况和用户行为报告

#### 5.6.3 纠纷处理中心
- **争议受理**：接收和处理用户提交的争议申请
- **证据查看**：查看争议相关的费用记录和支付凭证
- **仲裁决策**：根据证据进行争议仲裁和费用调整

#### 5.6.4 系统配置管理
- **参数配置**：可配置系统运行参数（费用上限、邀请码长度等）
- **模板管理**：管理各类通知和邮件模板
- **版本管理**：系统版本更新和回滚管理

#### 5.6.5 系统管理员监督功能
- **管理员行为监督权限**
  - 实时监控管理员的所有操作行为
  - 查看管理员登录日志、操作记录和行为轨迹
  - 监控管理员对用户权限的修改操作
  - 审核管理员的费用调整和纠纷处理决策

- **管理员权限管理权限**
  - 创建、修改、禁用管理员账户
  - 设置管理员的操作权限范围和限制条件
  - 重置管理员密码和权限设置
  - 审批管理员的权限升级请求

- **管理员操作审批权限**
  - 审批管理员的重要系统配置变更
  - 审核管理员删除或修改关键数据的行为
  - 批准管理员的系统维护和升级操作
  - 监控管理员的客户端功能控制操作

- **系统安全监督权限**
  - 监控系统安全事件和异常操作
  - 审核管理员的安全策略配置变更
  - 检查管理员的用户数据访问记录
  - 执行系统级安全审计和合规检查

- **管理员绩效监督权限**
  - 评估管理员的工作绩效和操作质量
  - 查看管理员处理的用户投诉和纠纷
  - 监控管理员的响应时间和解决效率
  - 生成管理员行为分析报告

---

## 6. 风险管理与应对策略

### 6.1 项目风险识别

#### 6.1.1 技术风险
- **系统稳定性风险**：高并发情况下系统可能出现性能瓶颈
- **数据安全风险**：用户敏感信息可能面临泄露风险
- **第三方依赖风险**：支付接口、短信服务等第三方服务可能不稳定

#### 6.1.2 业务风险
- **用户接受度风险**：用户可能对新的费用管理方式接受度不高
- **支付纠纷风险**：支付过程中可能出现纠纷，影响用户体验
- **权限滥用风险**：管理员可能滥用权限，影响系统公平性

#### 6.1.3 项目管理风险
- **进度延期风险**：开发过程中可能遇到技术难点导致延期
- **人员变动风险**：关键开发人员变动可能影响项目进度
- **需求变更风险**：频繁的需求变更可能导致开发成本增加

### 6.2 风险评估与应对

#### 6.2.1 技术风险应对
- **系统稳定性应对**：
  - 实施系统性能测试，优化数据库查询
  - 采用负载均衡和缓存机制
  - 设置系统监控和自动扩容机制

- **数据安全应对**：
  - 实施严格的数据加密措施
  - 建立完善的权限控制机制
  - 定期进行安全审计和渗透测试

- **第三方依赖应对**：
  - 选择稳定可靠的第三方服务提供商
  - 设计备用方案，支持多服务提供商切换
  - 建立服务监控和自动切换机制

#### 6.2.2 业务风险应对
- **用户接受度应对**：
  - 进行用户调研，了解用户真实需求
  - 设计简洁直观的用户界面
  - 提供详细的使用指南和客服支持

- **支付纠纷应对**：
  - 建立完善的支付记录和证据保存机制
  - 设计公正的纠纷处理流程
  - 提供多种支付方式，降低支付失败率

- **权限滥用应对**：
  - 实施严格的权限控制和审计机制
  - 建立系统管理员监督机制
  - 定期进行权限审查和调整

#### 6.2.3 项目管理风险应对
- **进度延期应对**：
  - 制定详细的项目计划和里程碑
  - 定期进行进度评估和调整
  - 预留缓冲时间应对突发情况

- **人员变动应对**：
  - 建立完善的文档和知识共享机制
  - 实施代码审查和结对编程
  - 培养多技能团队，减少单点依赖

- **需求变更应对**：
  - 建立需求变更评估机制
  - 实施敏捷开发方法，快速响应变更
  - 与客户保持密切沟通，控制变更范围

### 6.3 应急预案

#### 6.3.1 系统故障应急预案
- **故障等级划分**：
  - 一级故障：系统完全不可用，影响所有用户
  - 二级故障：部分功能不可用，影响部分用户
  - 三级故障：性能下降，用户体验受影响

- **应急响应流程**：
  - 故障发现和报告机制
  - 应急团队组建和职责分配
  - 故障定位和修复流程
  - 用户通知和安抚措施

#### 6.3.2 数据安全应急预案
- **数据泄露应对**：
  - 立即隔离受影响系统
  - 评估泄露范围和影响
  - 通知受影响用户和相关方
  - 采取补救措施防止进一步泄露

- **数据恢复预案**：
  - 建立定期数据备份机制
  - 制定数据恢复流程和测试方案
  - 确保关键数据可在短时间内恢复

---

## 7. 验收标准

### 7.1 功能验收标准

#### 7.1.1 核心功能验收
- **用户注册与登录**：
  - 支持邀请码注册和管理员邀请注册
  - 支持邮箱、手机号验证
  - 权限分配正确，各角色功能可正常使用

- **寝室管理**：
  - 寝室长可正常创建寝室并设置基本信息
  - 成员邀请功能正常，邀请码有效且唯一
  - 成员管理功能正常，角色分配正确

- **费用管理**：
  - 费用创建、编辑、删除功能正常
  - 智能分摊算法计算准确
  - 费用审核流程完整，状态流转正确

#### 7.1.2 支付功能验收
- **收款码管理**：
  - 支持微信、支付宝收款码上传
  - 收款码状态管理正常
  - 安全性验证有效

- **扫码支付**：
  - 支付流程完整，状态流转正确
  - 支付确认权限控制正确
  - 支付记录完整准确

#### 7.1.3 管理功能验收
- **用户管理**：
  - 用户信息管理功能完整
  - 权限管理功能正常
  - 批量操作功能可用

- **系统管理**：
  - 系统配置功能正常
  - 数据监控功能可用
  - 纠纷处理流程完整

### 7.2 性能验收标准

#### 7.2.1 响应时间标准
- **页面加载时间**：普通页面加载时间不超过2秒
- **API响应时间**：95%的API请求响应时间不超过500ms
- **数据库查询时间**：复杂查询响应时间不超过1秒

#### 7.2.2 并发处理标准
- **并发用户数**：支持至少1000用户同时在线
- **并发操作数**：支持每秒至少100次操作请求
- **峰值处理能力**：支持峰值期间3倍于平时的负载

#### 7.2.3 系统稳定性标准
- **系统可用性**：系统可用性不低于99.5%
- **故障恢复时间**：系统故障后30分钟内恢复服务
- **数据一致性**：数据操作一致性保证，无数据丢失

### 7.3 用户体验验收标准

#### 7.3.1 界面设计标准
- **界面一致性**：整体设计风格一致，符合UI设计规范
- **响应式设计**：支持不同屏幕尺寸和设备类型
- **无障碍访问**：符合基本的无障碍访问标准

#### 7.3.2 操作体验标准
- **操作流程**：核心功能操作流程不超过3步
- **错误提示**：提供清晰明确的错误提示和解决方案
- **帮助文档**：提供完整的帮助文档和使用指南

#### 7.3.3 用户满意度标准
- **用户满意度**：用户满意度调查得分不低于4.0（5分制）
- **用户留存率**：新用户7天留存率不低于60%
- **功能使用率**：核心功能使用率不低于80%